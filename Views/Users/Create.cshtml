@model Monolypix.ViewModels.CreateUserViewModel

@{
    ViewData["Title"] = "Criar Novo Usuário";
}

@if (TempData["ResultMessage"] != null)
{
    var result = new Monolypix.Models.Result<object>
    {
        Success = (bool)(TempData["ResultSuccess"] ?? false),
        Message = TempData["ResultMessage"]?.ToString() ?? string.Empty
    };
    await Html.RenderPartialAsync("_Toast", result);
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h2">
                <i class="fas fa-user-plus me-2"></i>
                Criar Novo Usuário
            </h1>
        </div>
        <div class="col-auto">
            <a href="@Url.Action("Index", "Home", new { id = Model.GameSessionId })" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>
                Voltar
            </a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <form asp-action="Create" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="GameSessionId" />
                        
                        <div class="mb-4">
                            <label asp-for="UserName" class="form-label">
                                <i class="fas fa-user me-1"></i>
                                @Html.DisplayNameFor(m => m.UserName)
                            </label>
                            <input asp-for="UserName" 
                                   class="form-control form-control-lg" 
                                   placeholder="Digite o nome do usuário"
                                   autocomplete="off"
                                   autofocus />
                            <span asp-validation-for="UserName" class="text-danger small"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="AvatarColor" class="form-label">
                                <i class="fas fa-palette me-1"></i>
                                @Html.DisplayNameFor(m => m.AvatarColor)
                            </label>
                            <div class="input-group">
                                <input asp-for="AvatarColor" 
                                       type="color" 
                                       class="form-control form-control-color" 
                                       id="avatarColorPicker"
                                       title="Escolha a cor do avatar" />
                                <input asp-for="AvatarColor" 
                                       type="text" 
                                       class="form-control" 
                                       id="avatarColorText"
                                       placeholder="#000000"
                                       maxlength="7"
                                       pattern="^#([A-Fa-f0-9]{6})$" />
                                <button type="button" class="btn btn-outline-secondary" id="randomColorBtn" title="Gerar cor aleatória">
                                    <i class="fas fa-random"></i>
                                </button>
                            </div>
                            <span asp-validation-for="AvatarColor" class="text-danger small"></span>
                            <small class="text-muted">Formato: #RRGGBB (ex: #FF5733)</small>
                        </div>

                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input asp-for="IsBanker" 
                                       class="form-check-input" 
                                       type="checkbox"
                                       role="switch" />
                                <label asp-for="IsBanker" class="form-check-label">
                                    <i class="fas fa-landmark me-1"></i>
                                    @Html.DisplayNameFor(m => m.IsBanker)
                                </label>
                            </div>
                            <span asp-validation-for="IsBanker" class="text-danger small"></span>
                            <small class="text-muted d-block mt-1">Marque esta opção se o usuário for o banqueiro da partida</small>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="@Url.Action("Index", "Home", new { id = Model.GameSessionId })" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>
                                Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check me-2"></i>
                                Criar Usuário
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="mt-3">
                <div class="alert alert-info" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Dica:</strong> Escolha um nome único e uma cor para identificar facilmente este jogador durante a partida.
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Sincronizar input de cor com input de texto
        document.addEventListener('DOMContentLoaded', function() {
            const colorPicker = document.getElementById('avatarColorPicker');
            const colorText = document.getElementById('avatarColorText');
            const randomBtn = document.getElementById('randomColorBtn');
            
            // Função para gerar cor aleatória
            function generateRandomColor() {
                const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0').toUpperCase();
                return randomColor;
            }
            
            // Inicializar com cor aleatória se não houver valor
            if (!colorText.value) {
                const initialColor = generateRandomColor();
                colorText.value = initialColor;
                colorPicker.value = initialColor;
            } else {
                colorPicker.value = colorText.value;
            }
            
            if (colorPicker && colorText) {
                colorPicker.addEventListener('input', function() {
                    colorText.value = this.value.toUpperCase();
                });
                
                colorText.addEventListener('input', function() {
                    if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                        colorPicker.value = this.value;
                    }
                });
            }
            
            // Botão para gerar cor aleatória
            if (randomBtn) {
                randomBtn.addEventListener('click', function() {
                    const randomColor = generateRandomColor();
                    colorText.value = randomColor;
                    colorPicker.value = randomColor;
                });
            }
        });
    </script>
}
